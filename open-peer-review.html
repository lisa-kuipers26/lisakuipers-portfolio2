<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Open Peer Review | Portofolio workflows</title>
  <meta name="description" content="Portofolio" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Open Peer Review | Portofolio workflows" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Portofolio" />
  <meta name="github-repo" content="portfolio" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Open Peer Review | Portofolio workflows" />
  
  <meta name="twitter:description" content="Portofolio" />
  

<meta name="author" content="Lisa Kuipers" />


<meta name="date" content="2022-05-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="c.-elegans-plate-experiment.html"/>
<link rel="next" href="applying-the-guerrilla-analytics-framework-to-your-own-project..html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introductie</a></li>
<li class="chapter" data-level="2" data-path="c.-elegans-plate-experiment.html"><a href="c.-elegans-plate-experiment.html"><i class="fa fa-check"></i><b>2</b> C. elegans plate experiment</a></li>
<li class="chapter" data-level="3" data-path="open-peer-review.html"><a href="open-peer-review.html"><i class="fa fa-check"></i><b>3</b> Open Peer Review</a>
<ul>
<li class="chapter" data-level="3.1" data-path="open-peer-review.html"><a href="open-peer-review.html#onderzoek-op-reproduceerbaarheid-beoordelen"><i class="fa fa-check"></i><b>3.1</b> Onderzoek op reproduceerbaarheid beoordelen</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="open-peer-review.html"><a href="open-peer-review.html#omschrijving-onderzoek"><i class="fa fa-check"></i><b>3.1.1</b> Omschrijving onderzoek</a></li>
<li class="chapter" data-level="3.1.2" data-path="open-peer-review.html"><a href="open-peer-review.html#beoordeling-artikel"><i class="fa fa-check"></i><b>3.1.2</b> Beoordeling artikel</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="open-peer-review.html"><a href="open-peer-review.html#code-zelf-reproduceren"><i class="fa fa-check"></i><b>3.2</b> Code zelf reproduceren</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="open-peer-review.html"><a href="open-peer-review.html#beoordeling-script"><i class="fa fa-check"></i><b>3.2.1</b> Beoordeling script</a></li>
<li class="chapter" data-level="3.2.2" data-path="open-peer-review.html"><a href="open-peer-review.html#probleem-in-script"><i class="fa fa-check"></i><b>3.2.2</b> Probleem in script</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="applying-the-guerrilla-analytics-framework-to-your-own-project..html"><a href="applying-the-guerrilla-analytics-framework-to-your-own-project..html"><i class="fa fa-check"></i><b>4</b> Applying the Guerrilla analytics framework to your own project.‚Äù</a></li>
<li class="chapter" data-level="5" data-path="cv.html"><a href="cv.html"><i class="fa fa-check"></i><b>5</b> cv</a></li>
<li class="chapter" data-level="6" data-path="vrije-ruimte---sql.html"><a href="vrije-ruimte---sql.html"><i class="fa fa-check"></i><b>6</b> Vrije ruimte - SQL</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Portofolio workflows</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="open-peer-review" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Open Peer Review<a href="open-peer-review.html#open-peer-review" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="onderzoek-op-reproduceerbaarheid-beoordelen" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Onderzoek op reproduceerbaarheid beoordelen<a href="open-peer-review.html#onderzoek-op-reproduceerbaarheid-beoordelen" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In dit gedeelte wordt een artikel beoordeeld op de reproduceerbaarheid. Deze wordt beoordeeld aan de hand van een verschillende criteria omschreven in de onderstaande tabel. Voor de beoordeling is een artikel gekozen primair onderzoek dat beschikbaar is op PMC.</p>
<p>Gebruikte artikel:</p>
<p>Amawi KF, Alkhatib AJ. Urtica Pilulifera in Treating Pre-diabetic Rat Model to Control the Blood Glucose, Lipids and Oxidative Stress. Med Arch. 2020;74(3):168-171. <a href="doi:10.5455/medarh.2020.74.168-171" class="uri">doi:10.5455/medarh.2020.74.168-171</a><br />
<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7405998/" class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7405998/</a></p>
<div id="omschrijving-onderzoek" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Omschrijving onderzoek<a href="open-peer-review.html#omschrijving-onderzoek" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Het doel van dit onderzoek is kijken of Urtica pilulifera (een plant) effect heeft op pre-diabetische ratten en ook de antioxiderende werking onderzoeken</p>
<p>De ratten werden ingedeeld in drie groepen van 10; een controle groep, een pre diabetische groep, en een groep met de behandeling van U. pilulifera.
De ratten pre-diabetisch gemaakt kregen een hoog sucrose dieet, de controle groep een normaal dieet en de behandelde groep kreeg hetzelfde dieet als de pre-diabetische ratten met U. pilulifera extract ge√Ønjecteerd. Na 30 dagen werden bloed samples afgenomen en getest op glucose, triglycerides, cholesterol, GSH, TAC en MDA</p>
<p>Uit het onderoek bleek dat glucose, triglyceride en MDA niveaus in de pre-diabetic groep significant verhoogd waren en significant verlaagd in de U. pilulifera groep.
GSH en TAC was significant hoger in de U. pilulifera ten opzichte van de pre-diabetische groep.
Er zat geen significant verschil in cholesterol niveau in de groepen.</p>
</div>
<div id="beoordeling-artikel" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Beoordeling artikel<a href="open-peer-review.html#beoordeling-artikel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In de tabel staat of het artikel aan de verschillende criterium voldoet.</p>
<table class="table table-striped" style="width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;">
Criteria
</th>
<th style="text-align:left;">
Answer
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Study purpose
</td>
<td style="text-align:left;">
Yes
</td>
</tr>
<tr>
<td style="text-align:left;">
Data availability
</td>
<td style="text-align:left;">
No
</td>
</tr>
<tr>
<td style="text-align:left;">
Data location
</td>
<td style="text-align:left;">
Data location not stated
</td>
</tr>
<tr>
<td style="text-align:left;">
Study location
</td>
<td style="text-align:left;">
Yes
</td>
</tr>
<tr>
<td style="text-align:left;">
Author review
</td>
<td style="text-align:left;">
Author listed but did not fill out contact
</td>
</tr>
<tr>
<td style="text-align:left;">
Ethics statement
</td>
<td style="text-align:left;">
No
</td>
</tr>
<tr>
<td style="text-align:left;">
Funding statement
</td>
<td style="text-align:left;">
Yes
</td>
</tr>
<tr>
<td style="text-align:left;">
Code availability
</td>
<td style="text-align:left;">
No
</td>
</tr>
</tbody>
</table>
<p>Het blijkt dat het artikel maar aan drie van acht criteria voldoet. Hoewel het artikel goed te lezen was is deze dus toch niet goed reproduceerbaar.</p>
</div>
</div>
<div id="code-zelf-reproduceren" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Code zelf reproduceren<a href="open-peer-review.html#code-zelf-reproduceren" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Net is er gekeken reporduceerbaarheid van een primair onderzoek. In dit onderdeel wordt er gekeken naar de reporduceerbaarheid van (R) code.</p>
<p>Data en code van onderstaand onderzoek gebruikt:
Strozza C, Myrskyl√§ M. Monitoring trends and differences in COVID-19 case-fatality rates using decomposition methods: Contributions of age structure and age-specific fatality. PLoS One. 2020 Sep 10;15(9):e0238904. doi: 10.1371/journal.pone.0238904. PMID: 32913365; PMCID: PMC7482960.
<a href="https://pubmed.ncbi.nlm.nih.gov/32913365/" class="uri">https://pubmed.ncbi.nlm.nih.gov/32913365/</a></p>
<p>Link naar de code:
<a href="https://osf.io/g7vjd/" class="uri">https://osf.io/g7vjd/</a></p>
<div id="beoordeling-script" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Beoordeling script<a href="open-peer-review.html#beoordeling-script" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Het script zelf was goed te lezen. Er waren 4 scripts die elkaar opvolgde, door de getallen in de bestandsnaam was het makkelijk te zien welke als eerst uitgevoerd moest worden. In de scripts zelf stonden genoeg comments om te begrijpen waar elk stuk code voor diende en ziet de code zelf er netjes uit. Ik geef de leesbaarheid dus ook een 5/5</p>
<p>De code was ook goed reproduceerbaar. Er was alleen √©√©n probleem wat handmatig opgelost moest worden, dit probleem en hoe deze opgelost is staat beschreven hieronder. Hierdoor krijgt de reproduceerbaarheid een 4/5, want nadat dit probleem opgelost was, konden alle tabellen makkelijk gemaakt worden.</p>
</div>
<div id="probleem-in-script" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Probleem in script<a href="open-peer-review.html#probleem-in-script" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="open-peer-review.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Monitoring trends and differences in COVID-19 case fatality  ##############</span></span>
<span id="cb3-2"><a href="open-peer-review.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">### rates using decomposition methods: A demographic perspective ##############</span></span>
<span id="cb3-3"><a href="open-peer-review.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="open-peer-review.html#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Last updated: 2020-07-16 09:27:20 CEST</span></span>
<span id="cb3-5"><a href="open-peer-review.html#cb3-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-6"><a href="open-peer-review.html#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Contact:</span></span>
<span id="cb3-7"><a href="open-peer-review.html#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">### riffe@demogr.mpg.de</span></span>
<span id="cb3-8"><a href="open-peer-review.html#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">### acosta@demogr.mpg.de</span></span>
<span id="cb3-9"><a href="open-peer-review.html#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">### dudel@demogr.mpg.de</span></span>
<span id="cb3-10"><a href="open-peer-review.html#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="open-peer-review.html#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="open-peer-review.html#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="do">### Get data ##################################################################</span></span>
<span id="cb3-13"><a href="open-peer-review.html#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="open-peer-review.html#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Required packages</span></span>
<span id="cb3-15"><a href="open-peer-review.html#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">source</span>((<span class="st">&quot;R/00_functions.R&quot;</span>))</span>
<span id="cb3-16"><a href="open-peer-review.html#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="open-peer-review.html#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># URL + filename</span></span>
<span id="cb3-18"><a href="open-peer-review.html#cb3-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-19"><a href="open-peer-review.html#cb3-19" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="st">&#39;https://osf.io/wu5ve//?action=download&#39;</span></span>
<span id="cb3-20"><a href="open-peer-review.html#cb3-20" aria-hidden="true" tabindex="-1"></a>  filename <span class="ot">&lt;-</span> <span class="st">&#39;Data/Output_10.csv&#39;</span></span>
<span id="cb3-21"><a href="open-peer-review.html#cb3-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-22"><a href="open-peer-review.html#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load data</span></span>
<span id="cb3-23"><a href="open-peer-review.html#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">GET</span>(url, <span class="fu">write_disk</span>(filename, <span class="at">overwrite =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-24"><a href="open-peer-review.html#cb3-24" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(filename,<span class="at">skip=</span><span class="dv">3</span>)</span></code></pre></div>
<p>Bij het uitvoeren van de code hierboven kwam de onderstaande foutmelding:</p>
<p><img src="images/error_r.png" /><!-- -->
In de foutmelding is html te zien. Dit hoort natuurlijk niet bij een read_csv() functie. In de code wordt het bestand van een online directory gedownload. De URL staat in de code en wanneer deze bezocht werd stond er dit bericht:</p>
<p><img src="images/error_web.png" /><!-- --></p>
<p>Het bestand bevindt zich niet meer op de plek waar de URL naar verwees en kon dus ook niet gedownload worden waardoor de html van de pagina werd overgenomen. Er was echter wel een menu aan de zijkant aanwezig waar het mogelijk is om bij de github van het project te komen. Hier vond ik het output bestand wat nodig is voor de code en heb deze handmatig gedownload en toegevoegd aan de /Data directory. Nadat deze in de directory stond kon het script en de rest van de scripts vlekkeloos uitgevoerd worden.Hieronder staan alle scripts met de aanpassing in het tweede script.</p>
<hr />
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="open-peer-review.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Monitoring trends and differences in COVID-19 case fatality  ##############</span></span>
<span id="cb4-2"><a href="open-peer-review.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="do">### rates using decomposition methods: A demographic perspective ##############</span></span>
<span id="cb4-3"><a href="open-peer-review.html#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="open-peer-review.html#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Last updated: 2020-07-14 11:19:20 CEST</span></span>
<span id="cb4-5"><a href="open-peer-review.html#cb4-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-6"><a href="open-peer-review.html#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Contact:</span></span>
<span id="cb4-7"><a href="open-peer-review.html#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">### riffe@demogr.mpg.de</span></span>
<span id="cb4-8"><a href="open-peer-review.html#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">### acosta@demogr.mpg.de</span></span>
<span id="cb4-9"><a href="open-peer-review.html#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">### dudel@demogr.mpg.de</span></span>
<span id="cb4-10"><a href="open-peer-review.html#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="open-peer-review.html#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="open-peer-review.html#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="do">### Load packages #############################################################</span></span>
<span id="cb4-13"><a href="open-peer-review.html#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="open-peer-review.html#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb4-15"><a href="open-peer-review.html#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(data.table)</span>
<span id="cb4-16"><a href="open-peer-review.html#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(writexl)</span>
<span id="cb4-17"><a href="open-peer-review.html#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(httr)</span>
<span id="cb4-18"><a href="open-peer-review.html#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="open-peer-review.html#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="open-peer-review.html#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="do">### Case fatality rate #######################################################</span></span>
<span id="cb4-21"><a href="open-peer-review.html#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="open-peer-review.html#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cc = case-age distribution</span></span>
<span id="cb4-23"><a href="open-peer-review.html#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rr = age-specific case fatality rates</span></span>
<span id="cb4-24"><a href="open-peer-review.html#cb4-24" aria-hidden="true" tabindex="-1"></a>  cfr <span class="ot">&lt;-</span> <span class="cf">function</span>(cc,rr){</span>
<span id="cb4-25"><a href="open-peer-review.html#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(cc <span class="sc">*</span> rr)</span>
<span id="cb4-26"><a href="open-peer-review.html#cb4-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-27"><a href="open-peer-review.html#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="open-peer-review.html#cb4-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-29"><a href="open-peer-review.html#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="do">### Kitagawa decomposition ####################################################</span></span>
<span id="cb4-30"><a href="open-peer-review.html#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="open-peer-review.html#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># c1 = Age distribution population 1</span></span>
<span id="cb4-32"><a href="open-peer-review.html#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># r1 = Case fatality rates population 1</span></span>
<span id="cb4-33"><a href="open-peer-review.html#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># c2 = Age distribution population 2</span></span>
<span id="cb4-34"><a href="open-peer-review.html#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># r2 = Case fatality rates population 2</span></span>
<span id="cb4-35"><a href="open-peer-review.html#cb4-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-36"><a href="open-peer-review.html#cb4-36" aria-hidden="true" tabindex="-1"></a>  kitagawa_cfr <span class="ot">&lt;-</span> <span class="cf">function</span>(c1, r1, c2, r2){</span>
<span id="cb4-37"><a href="open-peer-review.html#cb4-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-38"><a href="open-peer-review.html#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate age-distribution of cases</span></span>
<span id="cb4-39"><a href="open-peer-review.html#cb4-39" aria-hidden="true" tabindex="-1"></a>    c1  <span class="ot">&lt;-</span> c1 <span class="sc">/</span> <span class="fu">sum</span>(c1)</span>
<span id="cb4-40"><a href="open-peer-review.html#cb4-40" aria-hidden="true" tabindex="-1"></a>    c2  <span class="ot">&lt;-</span> c2 <span class="sc">/</span> <span class="fu">sum</span>(c2)</span>
<span id="cb4-41"><a href="open-peer-review.html#cb4-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-42"><a href="open-peer-review.html#cb4-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Total difference</span></span>
<span id="cb4-43"><a href="open-peer-review.html#cb4-43" aria-hidden="true" tabindex="-1"></a>    Tot <span class="ot">&lt;-</span> <span class="fu">cfr</span>(c1, r1) <span class="sc">-</span> <span class="fu">cfr</span>(c2, r2)</span>
<span id="cb4-44"><a href="open-peer-review.html#cb4-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-45"><a href="open-peer-review.html#cb4-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Age component</span></span>
<span id="cb4-46"><a href="open-peer-review.html#cb4-46" aria-hidden="true" tabindex="-1"></a>    Aa  <span class="ot">&lt;-</span> <span class="fu">sum</span>((c1 <span class="sc">-</span> c2) <span class="sc">*</span> (r1 <span class="sc">+</span> r2) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb4-47"><a href="open-peer-review.html#cb4-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-48"><a href="open-peer-review.html#cb4-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Case fatality component</span></span>
<span id="cb4-49"><a href="open-peer-review.html#cb4-49" aria-hidden="true" tabindex="-1"></a>    Bb  <span class="ot">&lt;-</span> <span class="fu">sum</span>((r1 <span class="sc">-</span> r2) <span class="sc">*</span> (c1 <span class="sc">+</span> c2) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb4-50"><a href="open-peer-review.html#cb4-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-51"><a href="open-peer-review.html#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Output</span></span>
<span id="cb4-52"><a href="open-peer-review.html#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">Diff =</span> Tot, </span>
<span id="cb4-53"><a href="open-peer-review.html#cb4-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">AgeComp =</span> Aa,</span>
<span id="cb4-54"><a href="open-peer-review.html#cb4-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">RateComp =</span> Bb, </span>
<span id="cb4-55"><a href="open-peer-review.html#cb4-55" aria-hidden="true" tabindex="-1"></a>         <span class="at">CFR1 =</span> <span class="fu">weighted.mean</span>(r1,c1), </span>
<span id="cb4-56"><a href="open-peer-review.html#cb4-56" aria-hidden="true" tabindex="-1"></a>         <span class="at">CFR2 =</span> <span class="fu">weighted.mean</span>(r2,c2))</span>
<span id="cb4-57"><a href="open-peer-review.html#cb4-57" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="open-peer-review.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Monitoring trends and differences in COVID-19 case fatality  ##############</span></span>
<span id="cb5-2"><a href="open-peer-review.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="do">### rates using decomposition methods: A demographic perspective ##############</span></span>
<span id="cb5-3"><a href="open-peer-review.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="open-peer-review.html#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Last updated: 2020-07-16 09:27:20 CEST</span></span>
<span id="cb5-5"><a href="open-peer-review.html#cb5-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-6"><a href="open-peer-review.html#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Contact:</span></span>
<span id="cb5-7"><a href="open-peer-review.html#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">### riffe@demogr.mpg.de</span></span>
<span id="cb5-8"><a href="open-peer-review.html#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">### acosta@demogr.mpg.de</span></span>
<span id="cb5-9"><a href="open-peer-review.html#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">### dudel@demogr.mpg.de</span></span>
<span id="cb5-10"><a href="open-peer-review.html#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="open-peer-review.html#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="open-peer-review.html#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="do">### Get data ##################################################################</span></span>
<span id="cb5-13"><a href="open-peer-review.html#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="open-peer-review.html#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Required packages</span></span>
<span id="cb5-15"><a href="open-peer-review.html#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">source</span>((<span class="st">&quot;R/00_functions.R&quot;</span>))</span>
<span id="cb5-16"><a href="open-peer-review.html#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="open-peer-review.html#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># URL + filename</span></span>
<span id="cb5-18"><a href="open-peer-review.html#cb5-18" aria-hidden="true" tabindex="-1"></a>  filename <span class="ot">&lt;-</span> <span class="st">&#39;Data/Output_10.csv&#39;</span></span>
<span id="cb5-19"><a href="open-peer-review.html#cb5-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-20"><a href="open-peer-review.html#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load data</span></span>
<span id="cb5-21"><a href="open-peer-review.html#cb5-21" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(filename,<span class="at">skip=</span><span class="dv">3</span>)</span>
<span id="cb5-22"><a href="open-peer-review.html#cb5-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-23"><a href="open-peer-review.html#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="do">### Edit data (select countries, etc.) ########################################</span></span>
<span id="cb5-24"><a href="open-peer-review.html#cb5-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-25"><a href="open-peer-review.html#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lists of countries and regions</span></span>
<span id="cb5-26"><a href="open-peer-review.html#cb5-26" aria-hidden="true" tabindex="-1"></a>  countrylist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;China&quot;</span>,<span class="st">&quot;Germany&quot;</span>,<span class="st">&quot;Italy&quot;</span>,<span class="st">&quot;South Korea&quot;</span>,<span class="st">&quot;Spain&quot;</span>,<span class="st">&quot;USA&quot;</span>)</span>
<span id="cb5-27"><a href="open-peer-review.html#cb5-27" aria-hidden="true" tabindex="-1"></a>  region <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;All&quot;</span>,<span class="st">&quot;NYC&quot;</span>)</span>
<span id="cb5-28"><a href="open-peer-review.html#cb5-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-29"><a href="open-peer-review.html#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Restrict</span></span>
<span id="cb5-30"><a href="open-peer-review.html#cb5-30" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country <span class="sc">%in%</span> countrylist <span class="sc">&amp;</span> Region <span class="sc">%in%</span> region)</span>
<span id="cb5-31"><a href="open-peer-review.html#cb5-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-32"><a href="open-peer-review.html#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove Tests variable</span></span>
<span id="cb5-33"><a href="open-peer-review.html#cb5-33" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Tests=</span><span class="cn">NULL</span>)</span>
<span id="cb5-34"><a href="open-peer-review.html#cb5-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-35"><a href="open-peer-review.html#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop if no cases/Deaths</span></span>
<span id="cb5-36"><a href="open-peer-review.html#cb5-36" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(dat)</span>
<span id="cb5-37"><a href="open-peer-review.html#cb5-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-38"><a href="open-peer-review.html#cb5-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-39"><a href="open-peer-review.html#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="do">### Save ######################################################################</span></span>
<span id="cb5-40"><a href="open-peer-review.html#cb5-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-41"><a href="open-peer-review.html#cb5-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(dat,<span class="at">file=</span><span class="st">&quot;Data/inputdata.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="open-peer-review.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Monitoring trends and differences in COVID-19 case fatality  ##############</span></span>
<span id="cb6-2"><a href="open-peer-review.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="do">### rates using decomposition methods: A demographic perspective ##############</span></span>
<span id="cb6-3"><a href="open-peer-review.html#cb6-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb6-4"><a href="open-peer-review.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Last updated: 2020-07-14 11:19:20 CEST</span></span>
<span id="cb6-5"><a href="open-peer-review.html#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="open-peer-review.html#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Contact:</span></span>
<span id="cb6-7"><a href="open-peer-review.html#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">### riffe@demogr.mpg.de</span></span>
<span id="cb6-8"><a href="open-peer-review.html#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">### acosta@demogr.mpg.de</span></span>
<span id="cb6-9"><a href="open-peer-review.html#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">### dudel@demogr.mpg.de</span></span>
<span id="cb6-10"><a href="open-peer-review.html#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="open-peer-review.html#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="open-peer-review.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="do">### Load functions &amp; packages #################################################</span></span>
<span id="cb6-13"><a href="open-peer-review.html#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="open-peer-review.html#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">source</span>((<span class="st">&quot;R/00_functions.R&quot;</span>))</span>
<span id="cb6-15"><a href="open-peer-review.html#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="open-peer-review.html#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="open-peer-review.html#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="do">### Load and edit data ########################################################</span></span>
<span id="cb6-18"><a href="open-peer-review.html#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="open-peer-review.html#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load CSV file</span></span>
<span id="cb6-20"><a href="open-peer-review.html#cb6-20" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;Data/inputdata.csv&quot;</span>)</span>
<span id="cb6-21"><a href="open-peer-review.html#cb6-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-22"><a href="open-peer-review.html#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set Date as date</span></span>
<span id="cb6-23"><a href="open-peer-review.html#cb6-23" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(dat<span class="sc">$</span>Date,<span class="st">&quot;%d.%m.%y&quot;</span>)</span>
<span id="cb6-24"><a href="open-peer-review.html#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="open-peer-review.html#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find max dates</span></span>
<span id="cb6-26"><a href="open-peer-review.html#cb6-26" aria-hidden="true" tabindex="-1"></a>  maxdates <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb6-27"><a href="open-peer-review.html#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Country,Region) <span class="sc">%&gt;%</span> </span>
<span id="cb6-28"><a href="open-peer-review.html#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">maxdate=</span><span class="fu">max</span>(Date))</span>
<span id="cb6-29"><a href="open-peer-review.html#cb6-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-30"><a href="open-peer-review.html#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get least common denominator</span></span>
<span id="cb6-31"><a href="open-peer-review.html#cb6-31" aria-hidden="true" tabindex="-1"></a>  maxdate <span class="ot">&lt;-</span> maxdates <span class="sc">%&gt;%</span> </span>
<span id="cb6-32"><a href="open-peer-review.html#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Country<span class="sc">!=</span><span class="st">&quot;China&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-33"><a href="open-peer-review.html#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-34"><a href="open-peer-review.html#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">min</span>(maxdate))</span>
<span id="cb6-35"><a href="open-peer-review.html#cb6-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-36"><a href="open-peer-review.html#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># As vector</span></span>
<span id="cb6-37"><a href="open-peer-review.html#cb6-37" aria-hidden="true" tabindex="-1"></a>  maxdate <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(maxdate)[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb6-38"><a href="open-peer-review.html#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="open-peer-review.html#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="open-peer-review.html#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="do">### Numbers for Table 1 #######################################################</span></span>
<span id="cb6-41"><a href="open-peer-review.html#cb6-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-42"><a href="open-peer-review.html#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Latest date: maxdate</span></span>
<span id="cb6-43"><a href="open-peer-review.html#cb6-43" aria-hidden="true" tabindex="-1"></a>  refdate <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;30.06.2020&quot;</span>,<span class="st">&quot;%d.%m.%Y&quot;</span>)</span>
<span id="cb6-44"><a href="open-peer-review.html#cb6-44" aria-hidden="true" tabindex="-1"></a>  dat2 <span class="ot">&lt;-</span> dat  <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Date<span class="sc">&lt;=</span>refdate) <span class="co">#maxdate</span></span>
<span id="cb6-45"><a href="open-peer-review.html#cb6-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-46"><a href="open-peer-review.html#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aggregate case and death counts</span></span>
<span id="cb6-47"><a href="open-peer-review.html#cb6-47" aria-hidden="true" tabindex="-1"></a>  cases <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(Cases<span class="sc">~</span>Code<span class="sc">+</span>Date<span class="sc">+</span>Country<span class="sc">+</span>Region,<span class="at">data=</span>dat2[dat2<span class="sc">$</span>Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>,],sum) </span>
<span id="cb6-48"><a href="open-peer-review.html#cb6-48" aria-hidden="true" tabindex="-1"></a>  deaths <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(Deaths<span class="sc">~</span>Code<span class="sc">+</span>Date<span class="sc">+</span>Country<span class="sc">+</span>Region,<span class="at">data=</span>dat2[dat2<span class="sc">$</span>Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>,],sum)</span>
<span id="cb6-49"><a href="open-peer-review.html#cb6-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-50"><a href="open-peer-review.html#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Most recent counts</span></span>
<span id="cb6-51"><a href="open-peer-review.html#cb6-51" aria-hidden="true" tabindex="-1"></a>  cases <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country,Region) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="fu">which.max</span>(Date))</span>
<span id="cb6-52"><a href="open-peer-review.html#cb6-52" aria-hidden="true" tabindex="-1"></a>  deaths <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country,Region) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="fu">which.max</span>(Date))</span>
<span id="cb6-53"><a href="open-peer-review.html#cb6-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-54"><a href="open-peer-review.html#cb6-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-55"><a href="open-peer-review.html#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="do">### Analysis for Table 2 (and appendix) #######################################</span></span>
<span id="cb6-56"><a href="open-peer-review.html#cb6-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-57"><a href="open-peer-review.html#cb6-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate ASFRs</span></span>
<span id="cb6-58"><a href="open-peer-review.html#cb6-58" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ascfr =</span> Deaths <span class="sc">/</span> Cases,</span>
<span id="cb6-59"><a href="open-peer-review.html#cb6-59" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ascfr =</span> <span class="fu">replace_na</span>(ascfr, <span class="dv">0</span>))</span>
<span id="cb6-60"><a href="open-peer-review.html#cb6-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-61"><a href="open-peer-review.html#cb6-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get codes for reference countries</span></span>
<span id="cb6-62"><a href="open-peer-review.html#cb6-62" aria-hidden="true" tabindex="-1"></a>  maxdate <span class="ot">&lt;-</span> <span class="fu">format.Date</span>(maxdate,<span class="st">&quot;%d.%m.%Y&quot;</span>)</span>
<span id="cb6-63"><a href="open-peer-review.html#cb6-63" aria-hidden="true" tabindex="-1"></a>  refdate <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;30.06.2020&quot;</span>,<span class="st">&quot;%d.%m.%Y&quot;</span>)</span>
<span id="cb6-64"><a href="open-peer-review.html#cb6-64" aria-hidden="true" tabindex="-1"></a>  refdate2 <span class="ot">&lt;-</span> <span class="fu">format.Date</span>(refdate,<span class="st">&quot;%d.%m.%Y&quot;</span>)<span class="co">#maxdate</span></span>
<span id="cb6-65"><a href="open-peer-review.html#cb6-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-66"><a href="open-peer-review.html#cb6-66" aria-hidden="true" tabindex="-1"></a>  DE_code <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;DE_&quot;</span>,refdate2)<span class="co">#paste0(&quot;DE_&quot;,maxdate)</span></span>
<span id="cb6-67"><a href="open-peer-review.html#cb6-67" aria-hidden="true" tabindex="-1"></a>  IT_code <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;ITbol&quot;</span>,refdate2)<span class="co">#paste0(&quot;ITinfo&quot;,maxdate)</span></span>
<span id="cb6-68"><a href="open-peer-review.html#cb6-68" aria-hidden="true" tabindex="-1"></a>  SK_code <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;KR&quot;</span>,refdate2)<span class="co">#paste0(&quot;SK&quot;,maxdate)</span></span>
<span id="cb6-69"><a href="open-peer-review.html#cb6-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-70"><a href="open-peer-review.html#cb6-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Decide some reference patterns (For main text: SK)</span></span>
<span id="cb6-71"><a href="open-peer-review.html#cb6-71" aria-hidden="true" tabindex="-1"></a>  DE <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb6-72"><a href="open-peer-review.html#cb6-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> DE_code,</span>
<span id="cb6-73"><a href="open-peer-review.html#cb6-73" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb6-74"><a href="open-peer-review.html#cb6-74" aria-hidden="true" tabindex="-1"></a>  IT <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb6-75"><a href="open-peer-review.html#cb6-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> IT_code,</span>
<span id="cb6-76"><a href="open-peer-review.html#cb6-76" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb6-77"><a href="open-peer-review.html#cb6-77" aria-hidden="true" tabindex="-1"></a>  SK <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb6-78"><a href="open-peer-review.html#cb6-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> SK_code,</span>
<span id="cb6-79"><a href="open-peer-review.html#cb6-79" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb6-80"><a href="open-peer-review.html#cb6-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-81"><a href="open-peer-review.html#cb6-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Decompose</span></span>
<span id="cb6-82"><a href="open-peer-review.html#cb6-82" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb6-83"><a href="open-peer-review.html#cb6-83" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">kitagawa_cfr</span>(DE<span class="sc">$</span>Cases, DE<span class="sc">$</span>ascfr,Cases,ascfr),</span>
<span id="cb6-84"><a href="open-peer-review.html#cb6-84" aria-hidden="true" tabindex="-1"></a>                              by<span class="ot">=</span><span class="fu">list</span>(Country, Code, Date, Sex, Region)]</span>
<span id="cb6-85"><a href="open-peer-review.html#cb6-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-86"><a href="open-peer-review.html#cb6-86" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb6-87"><a href="open-peer-review.html#cb6-87" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">kitagawa_cfr</span>(IT<span class="sc">$</span>Cases, IT<span class="sc">$</span>ascfr,Cases,ascfr),</span>
<span id="cb6-88"><a href="open-peer-review.html#cb6-88" aria-hidden="true" tabindex="-1"></a>                              by<span class="ot">=</span><span class="fu">list</span>(Country, Code, Date, Sex,Region)]</span>
<span id="cb6-89"><a href="open-peer-review.html#cb6-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-90"><a href="open-peer-review.html#cb6-90" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb6-91"><a href="open-peer-review.html#cb6-91" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">kitagawa_cfr</span>(SK<span class="sc">$</span>Cases, SK<span class="sc">$</span>ascfr,Cases,ascfr),</span>
<span id="cb6-92"><a href="open-peer-review.html#cb6-92" aria-hidden="true" tabindex="-1"></a>                              by<span class="ot">=</span><span class="fu">list</span>(Country, Code, Date, Sex,Region)]</span>
<span id="cb6-93"><a href="open-peer-review.html#cb6-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-94"><a href="open-peer-review.html#cb6-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only most recent date, both genders combined</span></span>
<span id="cb6-95"><a href="open-peer-review.html#cb6-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-96"><a href="open-peer-review.html#cb6-96" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country,Region) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Date<span class="sc">&lt;=</span>refdate) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="fu">which.max</span>(Date))</span>
<span id="cb6-97"><a href="open-peer-review.html#cb6-97" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> DecIT <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country,Region) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Date<span class="sc">&lt;=</span>refdate) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="fu">which.max</span>(Date))</span>
<span id="cb6-98"><a href="open-peer-review.html#cb6-98" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> DecSK <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country,Region) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Date<span class="sc">&lt;=</span>refdate) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="fu">which.max</span>(Date))</span>
<span id="cb6-99"><a href="open-peer-review.html#cb6-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-100"><a href="open-peer-review.html#cb6-100" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop unnecessary variables</span></span>
<span id="cb6-101"><a href="open-peer-review.html#cb6-101" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Region,Date,CFR2,Diff,AgeComp,RateComp)</span>
<span id="cb6-102"><a href="open-peer-review.html#cb6-102" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> DecIT <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Region,Date,CFR2,Diff,AgeComp,RateComp)</span>
<span id="cb6-103"><a href="open-peer-review.html#cb6-103" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> DecSK <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Region,Date,CFR2,Diff,AgeComp,RateComp)</span>
<span id="cb6-104"><a href="open-peer-review.html#cb6-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-105"><a href="open-peer-review.html#cb6-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate relative contributions</span></span>
<span id="cb6-106"><a href="open-peer-review.html#cb6-106" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeDE =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-107"><a href="open-peer-review.html#cb6-107" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateDE =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-108"><a href="open-peer-review.html#cb6-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-109"><a href="open-peer-review.html#cb6-109" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> DecIT <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeIT =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-110"><a href="open-peer-review.html#cb6-110" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> DecIT <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateIT =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-111"><a href="open-peer-review.html#cb6-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-112"><a href="open-peer-review.html#cb6-112" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> DecSK <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeSK =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-113"><a href="open-peer-review.html#cb6-113" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> DecSK <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateSK =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-114"><a href="open-peer-review.html#cb6-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-115"><a href="open-peer-review.html#cb6-115" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename</span></span>
<span id="cb6-116"><a href="open-peer-review.html#cb6-116" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffDE=</span>Diff,<span class="at">AgeCompDE=</span>AgeComp,<span class="at">RateCompDE=</span>RateComp)</span>
<span id="cb6-117"><a href="open-peer-review.html#cb6-117" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> DecIT <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffIT=</span>Diff,<span class="at">AgeCompIT=</span>AgeComp,<span class="at">RateCompIT=</span>RateComp)</span>
<span id="cb6-118"><a href="open-peer-review.html#cb6-118" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> DecSK <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffSK=</span>Diff,<span class="at">AgeCompSK=</span>AgeComp,<span class="at">RateCompSK=</span>RateComp)</span>
<span id="cb6-119"><a href="open-peer-review.html#cb6-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-120"><a href="open-peer-review.html#cb6-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort data</span></span>
<span id="cb6-121"><a href="open-peer-review.html#cb6-121" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(CFR2) <span class="co"># Appendix</span></span>
<span id="cb6-122"><a href="open-peer-review.html#cb6-122" aria-hidden="true" tabindex="-1"></a>  DecIT <span class="ot">&lt;-</span> DecIT <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(CFR2) <span class="co"># Appendix</span></span>
<span id="cb6-123"><a href="open-peer-review.html#cb6-123" aria-hidden="true" tabindex="-1"></a>  DecSK <span class="ot">&lt;-</span> DecSK <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(CFR2) <span class="co"># Table 2</span></span>
<span id="cb6-124"><a href="open-peer-review.html#cb6-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-125"><a href="open-peer-review.html#cb6-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-126"><a href="open-peer-review.html#cb6-126" aria-hidden="true" tabindex="-1"></a><span class="do">### Table 3: Italy trend ######################################################</span></span>
<span id="cb6-127"><a href="open-peer-review.html#cb6-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-128"><a href="open-peer-review.html#cb6-128" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Italy trend</span></span>
<span id="cb6-129"><a href="open-peer-review.html#cb6-129" aria-hidden="true" tabindex="-1"></a>  ITtrend <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb6-130"><a href="open-peer-review.html#cb6-130" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> <span class="st">&quot;ITbol09.03.2020&quot;</span>,</span>
<span id="cb6-131"><a href="open-peer-review.html#cb6-131" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb6-132"><a href="open-peer-review.html#cb6-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-133"><a href="open-peer-review.html#cb6-133" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate decomposition</span></span>
<span id="cb6-134"><a href="open-peer-review.html#cb6-134" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb6-135"><a href="open-peer-review.html#cb6-135" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">kitagawa_cfr</span>(Cases,ascfr,ITtrend<span class="sc">$</span>Cases, ITtrend<span class="sc">$</span>ascfr),</span>
<span id="cb6-136"><a href="open-peer-review.html#cb6-136" aria-hidden="true" tabindex="-1"></a>                                   by<span class="ot">=</span><span class="fu">list</span>(Country, Code, Date, Sex)]</span>
<span id="cb6-137"><a href="open-peer-review.html#cb6-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-138"><a href="open-peer-review.html#cb6-138" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only Italy</span></span>
<span id="cb6-139"><a href="open-peer-review.html#cb6-139" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> DecITtrend <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">&quot;Italy&quot;</span> <span class="sc">&amp;</span> Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) </span>
<span id="cb6-140"><a href="open-peer-review.html#cb6-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-141"><a href="open-peer-review.html#cb6-141" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only keep interesting variables</span></span>
<span id="cb6-142"><a href="open-peer-review.html#cb6-142" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> DecITtrend <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Code,Date,CFR1,Diff,AgeComp,RateComp)</span>
<span id="cb6-143"><a href="open-peer-review.html#cb6-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-144"><a href="open-peer-review.html#cb6-144" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Relative contributions</span></span>
<span id="cb6-145"><a href="open-peer-review.html#cb6-145" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> DecITtrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeDE =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-146"><a href="open-peer-review.html#cb6-146" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> DecITtrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateDE =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-147"><a href="open-peer-review.html#cb6-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-148"><a href="open-peer-review.html#cb6-148" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename</span></span>
<span id="cb6-149"><a href="open-peer-review.html#cb6-149" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> DecITtrend <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffITt=</span>Diff,<span class="at">AgeCompITt=</span>AgeComp,<span class="at">RateCompITt=</span>RateComp)</span>
<span id="cb6-150"><a href="open-peer-review.html#cb6-150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-151"><a href="open-peer-review.html#cb6-151" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort data</span></span>
<span id="cb6-152"><a href="open-peer-review.html#cb6-152" aria-hidden="true" tabindex="-1"></a>  DecITtrend <span class="ot">&lt;-</span> DecITtrend <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Date)</span>
<span id="cb6-153"><a href="open-peer-review.html#cb6-153" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-154"><a href="open-peer-review.html#cb6-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-155"><a href="open-peer-review.html#cb6-155" aria-hidden="true" tabindex="-1"></a><span class="do">### Appendix: Trends USA/Spain ################################################</span></span>
<span id="cb6-156"><a href="open-peer-review.html#cb6-156" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-157"><a href="open-peer-review.html#cb6-157" aria-hidden="true" tabindex="-1"></a>  <span class="do">### NYC trend</span></span>
<span id="cb6-158"><a href="open-peer-review.html#cb6-158" aria-hidden="true" tabindex="-1"></a>  NYtrend <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb6-159"><a href="open-peer-review.html#cb6-159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> <span class="st">&quot;US_NYC22.03.2020&quot;</span>,</span>
<span id="cb6-160"><a href="open-peer-review.html#cb6-160" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb6-161"><a href="open-peer-review.html#cb6-161" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-162"><a href="open-peer-review.html#cb6-162" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate decomposition</span></span>
<span id="cb6-163"><a href="open-peer-review.html#cb6-163" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb6-164"><a href="open-peer-review.html#cb6-164" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">kitagawa_cfr</span>(Cases,ascfr,NYtrend<span class="sc">$</span>Cases, NYtrend<span class="sc">$</span>ascfr),</span>
<span id="cb6-165"><a href="open-peer-review.html#cb6-165" aria-hidden="true" tabindex="-1"></a>                                   by<span class="ot">=</span><span class="fu">list</span>(Country, Region,Code, Date, Sex)]</span>
<span id="cb6-166"><a href="open-peer-review.html#cb6-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-167"><a href="open-peer-review.html#cb6-167" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only NYC</span></span>
<span id="cb6-168"><a href="open-peer-review.html#cb6-168" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> DecNYtrend <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">&quot;USA&quot;</span> <span class="sc">&amp;</span> Region<span class="sc">==</span><span class="st">&quot;NYC&quot;</span> <span class="sc">&amp;</span> Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) </span>
<span id="cb6-169"><a href="open-peer-review.html#cb6-169" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-170"><a href="open-peer-review.html#cb6-170" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only keep interesting variables</span></span>
<span id="cb6-171"><a href="open-peer-review.html#cb6-171" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> DecNYtrend <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Code,Date,CFR1,Diff,AgeComp,RateComp)</span>
<span id="cb6-172"><a href="open-peer-review.html#cb6-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-173"><a href="open-peer-review.html#cb6-173" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Relative contributions</span></span>
<span id="cb6-174"><a href="open-peer-review.html#cb6-174" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> DecNYtrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeDE =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-175"><a href="open-peer-review.html#cb6-175" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> DecNYtrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateDE =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-176"><a href="open-peer-review.html#cb6-176" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-177"><a href="open-peer-review.html#cb6-177" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename</span></span>
<span id="cb6-178"><a href="open-peer-review.html#cb6-178" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> DecNYtrend <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffITt=</span>Diff,<span class="at">AgeCompITt=</span>AgeComp,<span class="at">RateCompITt=</span>RateComp)</span>
<span id="cb6-179"><a href="open-peer-review.html#cb6-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-180"><a href="open-peer-review.html#cb6-180" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort data</span></span>
<span id="cb6-181"><a href="open-peer-review.html#cb6-181" aria-hidden="true" tabindex="-1"></a>  DecNYtrend <span class="ot">&lt;-</span> DecNYtrend <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Date)</span>
<span id="cb6-182"><a href="open-peer-review.html#cb6-182" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-183"><a href="open-peer-review.html#cb6-183" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Spain trend</span></span>
<span id="cb6-184"><a href="open-peer-review.html#cb6-184" aria-hidden="true" tabindex="-1"></a>  EStrend <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb6-185"><a href="open-peer-review.html#cb6-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> <span class="st">&quot;ES21.03.2020&quot;</span>,</span>
<span id="cb6-186"><a href="open-peer-review.html#cb6-186" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb6-187"><a href="open-peer-review.html#cb6-187" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-188"><a href="open-peer-review.html#cb6-188" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate decomposition</span></span>
<span id="cb6-189"><a href="open-peer-review.html#cb6-189" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb6-190"><a href="open-peer-review.html#cb6-190" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">kitagawa_cfr</span>(Cases,ascfr,EStrend<span class="sc">$</span>Cases, EStrend<span class="sc">$</span>ascfr),</span>
<span id="cb6-191"><a href="open-peer-review.html#cb6-191" aria-hidden="true" tabindex="-1"></a>                                   by<span class="ot">=</span><span class="fu">list</span>(Country, Code, Date, Sex)]</span>
<span id="cb6-192"><a href="open-peer-review.html#cb6-192" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-193"><a href="open-peer-review.html#cb6-193" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only Spain</span></span>
<span id="cb6-194"><a href="open-peer-review.html#cb6-194" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> DecEStrend <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">&quot;Spain&quot;</span> <span class="sc">&amp;</span> Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) </span>
<span id="cb6-195"><a href="open-peer-review.html#cb6-195" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-196"><a href="open-peer-review.html#cb6-196" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only keep interesting variables</span></span>
<span id="cb6-197"><a href="open-peer-review.html#cb6-197" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> DecEStrend <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Code,Date,CFR1,Diff,AgeComp,RateComp)</span>
<span id="cb6-198"><a href="open-peer-review.html#cb6-198" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-199"><a href="open-peer-review.html#cb6-199" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Relative contributions</span></span>
<span id="cb6-200"><a href="open-peer-review.html#cb6-200" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> DecEStrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeDE =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-201"><a href="open-peer-review.html#cb6-201" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> DecEStrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateDE =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-202"><a href="open-peer-review.html#cb6-202" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-203"><a href="open-peer-review.html#cb6-203" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename</span></span>
<span id="cb6-204"><a href="open-peer-review.html#cb6-204" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> DecEStrend <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffITt=</span>Diff,<span class="at">AgeCompITt=</span>AgeComp,<span class="at">RateCompITt=</span>RateComp)</span>
<span id="cb6-205"><a href="open-peer-review.html#cb6-205" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-206"><a href="open-peer-review.html#cb6-206" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort data</span></span>
<span id="cb6-207"><a href="open-peer-review.html#cb6-207" aria-hidden="true" tabindex="-1"></a>  DecEStrend <span class="ot">&lt;-</span> DecEStrend <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Date)</span>
<span id="cb6-208"><a href="open-peer-review.html#cb6-208" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-209"><a href="open-peer-review.html#cb6-209" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Germany trend</span></span>
<span id="cb6-210"><a href="open-peer-review.html#cb6-210" aria-hidden="true" tabindex="-1"></a>  DEtrend <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb6-211"><a href="open-peer-review.html#cb6-211" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Code <span class="sc">==</span> <span class="st">&quot;DE_21.03.2020&quot;</span>,</span>
<span id="cb6-212"><a href="open-peer-review.html#cb6-212" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb6-213"><a href="open-peer-review.html#cb6-213" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-214"><a href="open-peer-review.html#cb6-214" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate decomposition</span></span>
<span id="cb6-215"><a href="open-peer-review.html#cb6-215" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb6-216"><a href="open-peer-review.html#cb6-216" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">kitagawa_cfr</span>(Cases,ascfr,DEtrend<span class="sc">$</span>Cases, DEtrend<span class="sc">$</span>ascfr),</span>
<span id="cb6-217"><a href="open-peer-review.html#cb6-217" aria-hidden="true" tabindex="-1"></a>                                   by<span class="ot">=</span><span class="fu">list</span>(Country, Code, Date, Sex)]</span>
<span id="cb6-218"><a href="open-peer-review.html#cb6-218" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-219"><a href="open-peer-review.html#cb6-219" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only Germany</span></span>
<span id="cb6-220"><a href="open-peer-review.html#cb6-220" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> DecDEtrend <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country<span class="sc">==</span><span class="st">&quot;Germany&quot;</span> <span class="sc">&amp;</span> Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span> <span class="sc">&amp;</span> Date<span class="sc">&gt;=</span><span class="st">&quot;2020-03-21&quot;</span>) </span>
<span id="cb6-221"><a href="open-peer-review.html#cb6-221" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-222"><a href="open-peer-review.html#cb6-222" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only keep interesting variables</span></span>
<span id="cb6-223"><a href="open-peer-review.html#cb6-223" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> DecDEtrend <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Code,Date,CFR1,Diff,AgeComp,RateComp)</span>
<span id="cb6-224"><a href="open-peer-review.html#cb6-224" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-225"><a href="open-peer-review.html#cb6-225" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Relative contributions</span></span>
<span id="cb6-226"><a href="open-peer-review.html#cb6-226" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> DecDEtrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeDE =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-227"><a href="open-peer-review.html#cb6-227" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> DecDEtrend <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateDE =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb6-228"><a href="open-peer-review.html#cb6-228" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-229"><a href="open-peer-review.html#cb6-229" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename</span></span>
<span id="cb6-230"><a href="open-peer-review.html#cb6-230" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> DecDEtrend <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffITt=</span>Diff,<span class="at">AgeCompITt=</span>AgeComp,<span class="at">RateCompITt=</span>RateComp)</span>
<span id="cb6-231"><a href="open-peer-review.html#cb6-231" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-232"><a href="open-peer-review.html#cb6-232" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort data</span></span>
<span id="cb6-233"><a href="open-peer-review.html#cb6-233" aria-hidden="true" tabindex="-1"></a>  DecDEtrend <span class="ot">&lt;-</span> DecDEtrend <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Date)</span>
<span id="cb6-234"><a href="open-peer-review.html#cb6-234" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-235"><a href="open-peer-review.html#cb6-235" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-236"><a href="open-peer-review.html#cb6-236" aria-hidden="true" tabindex="-1"></a><span class="do">### Save results ##############################################################</span></span>
<span id="cb6-237"><a href="open-peer-review.html#cb6-237" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-238"><a href="open-peer-review.html#cb6-238" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Table 2</span></span>
<span id="cb6-239"><a href="open-peer-review.html#cb6-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecSK,</span>
<span id="cb6-240"><a href="open-peer-review.html#cb6-240" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;Output/Table2.xlsx&quot;</span>)</span>
<span id="cb6-241"><a href="open-peer-review.html#cb6-241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-242"><a href="open-peer-review.html#cb6-242" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Table 3</span></span>
<span id="cb6-243"><a href="open-peer-review.html#cb6-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecITtrend,</span>
<span id="cb6-244"><a href="open-peer-review.html#cb6-244" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;Output/Table3.xlsx&quot;</span>)</span>
<span id="cb6-245"><a href="open-peer-review.html#cb6-245" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-246"><a href="open-peer-review.html#cb6-246" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Appendix table 1</span></span>
<span id="cb6-247"><a href="open-peer-review.html#cb6-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecDE,</span>
<span id="cb6-248"><a href="open-peer-review.html#cb6-248" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;Output/AppendixTab1.xlsx&quot;</span>)</span>
<span id="cb6-249"><a href="open-peer-review.html#cb6-249" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-250"><a href="open-peer-review.html#cb6-250" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Appendix table 2</span></span>
<span id="cb6-251"><a href="open-peer-review.html#cb6-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecIT,</span>
<span id="cb6-252"><a href="open-peer-review.html#cb6-252" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;Output/AppendixTab2.xlsx&quot;</span>)</span>
<span id="cb6-253"><a href="open-peer-review.html#cb6-253" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-254"><a href="open-peer-review.html#cb6-254" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Appendix table 3</span></span>
<span id="cb6-255"><a href="open-peer-review.html#cb6-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecNYtrend,</span>
<span id="cb6-256"><a href="open-peer-review.html#cb6-256" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;Output/AppendixTab3.xlsx&quot;</span>)</span>
<span id="cb6-257"><a href="open-peer-review.html#cb6-257" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-258"><a href="open-peer-review.html#cb6-258" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Appendix table 4</span></span>
<span id="cb6-259"><a href="open-peer-review.html#cb6-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecEStrend,</span>
<span id="cb6-260"><a href="open-peer-review.html#cb6-260" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;Output/AppendixTab4.xlsx&quot;</span>)</span>
<span id="cb6-261"><a href="open-peer-review.html#cb6-261" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-262"><a href="open-peer-review.html#cb6-262" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Appendix table 5</span></span>
<span id="cb6-263"><a href="open-peer-review.html#cb6-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecDEtrend,</span>
<span id="cb6-264"><a href="open-peer-review.html#cb6-264" aria-hidden="true" tabindex="-1"></a>             <span class="at">path=</span><span class="st">&quot;Output/AppendixTab5.xlsx&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="open-peer-review.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Monitoring trends and differences in COVID-19 case fatality  ##############</span></span>
<span id="cb7-2"><a href="open-peer-review.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">### rates using decomposition methods: A demographic perspective ##############</span></span>
<span id="cb7-3"><a href="open-peer-review.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-4"><a href="open-peer-review.html#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Last updated: 2020-07-15 16:26:50 CEST</span></span>
<span id="cb7-5"><a href="open-peer-review.html#cb7-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-6"><a href="open-peer-review.html#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Contact:</span></span>
<span id="cb7-7"><a href="open-peer-review.html#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">### riffe@demogr.mpg.de</span></span>
<span id="cb7-8"><a href="open-peer-review.html#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">### acosta@demogr.mpg.de</span></span>
<span id="cb7-9"><a href="open-peer-review.html#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">### dudel@demogr.mpg.de</span></span>
<span id="cb7-10"><a href="open-peer-review.html#cb7-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-11"><a href="open-peer-review.html#cb7-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-12"><a href="open-peer-review.html#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="do">### Load functions &amp; packages #################################################</span></span>
<span id="cb7-13"><a href="open-peer-review.html#cb7-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-14"><a href="open-peer-review.html#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">source</span>((<span class="st">&quot;R/00_functions.R&quot;</span>))</span>
<span id="cb7-15"><a href="open-peer-review.html#cb7-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-16"><a href="open-peer-review.html#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="open-peer-review.html#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="do">### Load case data ############################################################</span></span>
<span id="cb7-18"><a href="open-peer-review.html#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="open-peer-review.html#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load data</span></span>
<span id="cb7-20"><a href="open-peer-review.html#cb7-20" aria-hidden="true" tabindex="-1"></a>  cases <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;Data/inputdata.csv&quot;</span>)</span>
<span id="cb7-21"><a href="open-peer-review.html#cb7-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-22"><a href="open-peer-review.html#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Edit date</span></span>
<span id="cb7-23"><a href="open-peer-review.html#cb7-23" aria-hidden="true" tabindex="-1"></a>  cases<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(cases<span class="sc">$</span>Date,<span class="st">&quot;%d.%m.%y&quot;</span>)</span>
<span id="cb7-24"><a href="open-peer-review.html#cb7-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-25"><a href="open-peer-review.html#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lists of countries and regions</span></span>
<span id="cb7-26"><a href="open-peer-review.html#cb7-26" aria-hidden="true" tabindex="-1"></a>  countrylist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;China&quot;</span>,<span class="st">&quot;Germany&quot;</span>,<span class="st">&quot;Italy&quot;</span>,<span class="st">&quot;South Korea&quot;</span>,<span class="st">&quot;Spain&quot;</span>,<span class="st">&quot;USA&quot;</span>)</span>
<span id="cb7-27"><a href="open-peer-review.html#cb7-27" aria-hidden="true" tabindex="-1"></a>  regionlist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;All&quot;</span>)</span>
<span id="cb7-28"><a href="open-peer-review.html#cb7-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-29"><a href="open-peer-review.html#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Restrict</span></span>
<span id="cb7-30"><a href="open-peer-review.html#cb7-30" aria-hidden="true" tabindex="-1"></a>  cases <span class="ot">&lt;-</span> cases <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country <span class="sc">%in%</span> countrylist <span class="sc">&amp;</span> Region <span class="sc">%in%</span> regionlist)</span>
<span id="cb7-31"><a href="open-peer-review.html#cb7-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-32"><a href="open-peer-review.html#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop tests</span></span>
<span id="cb7-33"><a href="open-peer-review.html#cb7-33" aria-hidden="true" tabindex="-1"></a>  cases <span class="ot">&lt;-</span> cases <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Tests=</span><span class="cn">NULL</span>)</span>
<span id="cb7-34"><a href="open-peer-review.html#cb7-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-35"><a href="open-peer-review.html#cb7-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-36"><a href="open-peer-review.html#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="do">### Load and edit excess mortality data #######################################</span></span>
<span id="cb7-37"><a href="open-peer-review.html#cb7-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-38"><a href="open-peer-review.html#cb7-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load CSV file</span></span>
<span id="cb7-39"><a href="open-peer-review.html#cb7-39" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;Data/baseline_excess_pclm_5.csv&quot;</span>)</span>
<span id="cb7-40"><a href="open-peer-review.html#cb7-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-41"><a href="open-peer-review.html#cb7-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set Date as date</span></span>
<span id="cb7-42"><a href="open-peer-review.html#cb7-42" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(dat<span class="sc">$</span>date,<span class="st">&quot;%d.%m.%y&quot;</span>)</span>
<span id="cb7-43"><a href="open-peer-review.html#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="open-peer-review.html#cb7-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Restrict</span></span>
<span id="cb7-45"><a href="open-peer-review.html#cb7-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Restrict</span></span>
<span id="cb7-46"><a href="open-peer-review.html#cb7-46" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Country <span class="sc">%in%</span> countrylist) <span class="sc">%&gt;%</span> </span>
<span id="cb7-47"><a href="open-peer-review.html#cb7-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Date <span class="sc">&gt;=</span> <span class="st">&quot;2020-02-24&quot;</span>)</span>
<span id="cb7-48"><a href="open-peer-review.html#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="open-peer-review.html#cb7-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-50"><a href="open-peer-review.html#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="do">### Analysis similar to Table 2 ###############################################</span></span>
<span id="cb7-51"><a href="open-peer-review.html#cb7-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-52"><a href="open-peer-review.html#cb7-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate cumulative excess deaths</span></span>
<span id="cb7-53"><a href="open-peer-review.html#cb7-53" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb7-54"><a href="open-peer-review.html#cb7-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">exc_p =</span> <span class="fu">ifelse</span>(excess <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, excess)) <span class="sc">%&gt;%</span></span>
<span id="cb7-55"><a href="open-peer-review.html#cb7-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Country,Age,Sex) <span class="sc">%&gt;%</span> </span>
<span id="cb7-56"><a href="open-peer-review.html#cb7-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Exc =</span> <span class="fu">cumsum</span>(exc_p)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb7-57"><a href="open-peer-review.html#cb7-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-58"><a href="open-peer-review.html#cb7-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Edit age variable</span></span>
<span id="cb7-59"><a href="open-peer-review.html#cb7-59" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Age=</span><span class="fu">recode</span>(Age,</span>
<span id="cb7-60"><a href="open-peer-review.html#cb7-60" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;5&#39;</span><span class="ot">=</span><span class="dv">0</span>,</span>
<span id="cb7-61"><a href="open-peer-review.html#cb7-61" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;15&#39;</span><span class="ot">=</span><span class="dv">10</span>,</span>
<span id="cb7-62"><a href="open-peer-review.html#cb7-62" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;25&#39;</span><span class="ot">=</span><span class="dv">20</span>,</span>
<span id="cb7-63"><a href="open-peer-review.html#cb7-63" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;35&#39;</span><span class="ot">=</span><span class="dv">30</span>,</span>
<span id="cb7-64"><a href="open-peer-review.html#cb7-64" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;45&#39;</span><span class="ot">=</span><span class="dv">40</span>,</span>
<span id="cb7-65"><a href="open-peer-review.html#cb7-65" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;55&#39;</span><span class="ot">=</span><span class="dv">50</span>,</span>
<span id="cb7-66"><a href="open-peer-review.html#cb7-66" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;65&#39;</span><span class="ot">=</span><span class="dv">60</span>,</span>
<span id="cb7-67"><a href="open-peer-review.html#cb7-67" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;75&#39;</span><span class="ot">=</span><span class="dv">70</span>,</span>
<span id="cb7-68"><a href="open-peer-review.html#cb7-68" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;85&#39;</span><span class="ot">=</span><span class="dv">80</span>,</span>
<span id="cb7-69"><a href="open-peer-review.html#cb7-69" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&#39;95&#39;</span><span class="ot">=</span><span class="dv">90</span>))</span>
<span id="cb7-70"><a href="open-peer-review.html#cb7-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-71"><a href="open-peer-review.html#cb7-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aggregate</span></span>
<span id="cb7-72"><a href="open-peer-review.html#cb7-72" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country,Sex,Date,Age,Week) <span class="sc">%&gt;%</span> </span>
<span id="cb7-73"><a href="open-peer-review.html#cb7-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Exc) <span class="sc">%&gt;%</span> <span class="fu">summarize_all</span>(sum)</span>
<span id="cb7-74"><a href="open-peer-review.html#cb7-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-75"><a href="open-peer-review.html#cb7-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adjust date for US: case countrs from two days earlier than excess mortality</span></span>
<span id="cb7-76"><a href="open-peer-review.html#cb7-76" aria-hidden="true" tabindex="-1"></a>  cases<span class="sc">$</span>Date[cases<span class="sc">$</span>Date<span class="sc">==</span><span class="st">&quot;2020-05-23&quot;</span> <span class="sc">&amp;</span> cases<span class="sc">$</span>Country<span class="sc">==</span><span class="st">&quot;USA&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;2020-05-25&quot;</span></span>
<span id="cb7-77"><a href="open-peer-review.html#cb7-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-78"><a href="open-peer-review.html#cb7-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge with cases</span></span>
<span id="cb7-79"><a href="open-peer-review.html#cb7-79" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(dat,cases[,<span class="fu">c</span>(<span class="st">&quot;Country&quot;</span>,<span class="st">&quot;Date&quot;</span>,<span class="st">&quot;Age&quot;</span>,<span class="st">&quot;Sex&quot;</span>,<span class="st">&quot;Cases&quot;</span>)])</span>
<span id="cb7-80"><a href="open-peer-review.html#cb7-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-81"><a href="open-peer-review.html#cb7-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate ASFRs</span></span>
<span id="cb7-82"><a href="open-peer-review.html#cb7-82" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ascfr =</span> Exc <span class="sc">/</span> Cases,</span>
<span id="cb7-83"><a href="open-peer-review.html#cb7-83" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ascfr =</span> <span class="fu">replace_na</span>(ascfr, <span class="dv">0</span>),</span>
<span id="cb7-84"><a href="open-peer-review.html#cb7-84" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ascfr =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(ascfr),<span class="dv">0</span>,ascfr),</span>
<span id="cb7-85"><a href="open-peer-review.html#cb7-85" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ascfr =</span> <span class="fu">ifelse</span>(ascfr<span class="sc">&gt;</span><span class="dv">1</span>,<span class="dv">1</span>,ascfr))</span>
<span id="cb7-86"><a href="open-peer-review.html#cb7-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-87"><a href="open-peer-review.html#cb7-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Decide some reference patterns (here Germany)</span></span>
<span id="cb7-88"><a href="open-peer-review.html#cb7-88" aria-hidden="true" tabindex="-1"></a>  DE <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb7-89"><a href="open-peer-review.html#cb7-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Country <span class="sc">==</span> <span class="st">&quot;Germany&quot;</span>,</span>
<span id="cb7-90"><a href="open-peer-review.html#cb7-90" aria-hidden="true" tabindex="-1"></a>           Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb7-91"><a href="open-peer-review.html#cb7-91" aria-hidden="true" tabindex="-1"></a>           <span class="co">#Date == maxdate)</span></span>
<span id="cb7-92"><a href="open-peer-review.html#cb7-92" aria-hidden="true" tabindex="-1"></a>           Week <span class="sc">==</span> <span class="dv">19</span>)</span>
<span id="cb7-93"><a href="open-peer-review.html#cb7-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-94"><a href="open-peer-review.html#cb7-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-95"><a href="open-peer-review.html#cb7-95" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Decompose</span></span>
<span id="cb7-96"><a href="open-peer-review.html#cb7-96" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dat)[,</span>
<span id="cb7-97"><a href="open-peer-review.html#cb7-97" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">kitagawa_cfr</span>(DE<span class="sc">$</span>Cases, DE<span class="sc">$</span>ascfr,Cases,ascfr),</span>
<span id="cb7-98"><a href="open-peer-review.html#cb7-98" aria-hidden="true" tabindex="-1"></a>                              by<span class="ot">=</span><span class="fu">list</span>(Country,Week, Sex)]</span>
<span id="cb7-99"><a href="open-peer-review.html#cb7-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-100"><a href="open-peer-review.html#cb7-100" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only most recent date, both genders combined</span></span>
<span id="cb7-101"><a href="open-peer-review.html#cb7-101" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sex<span class="sc">==</span><span class="st">&quot;b&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Week <span class="sc">%in%</span> <span class="dv">19</span><span class="sc">:</span><span class="dv">22</span>)</span>
<span id="cb7-102"><a href="open-peer-review.html#cb7-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-103"><a href="open-peer-review.html#cb7-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop unnecessary variables</span></span>
<span id="cb7-104"><a href="open-peer-review.html#cb7-104" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country,Week,CFR2,Diff,AgeComp,RateComp)</span>
<span id="cb7-105"><a href="open-peer-review.html#cb7-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-106"><a href="open-peer-review.html#cb7-106" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate relative contributions</span></span>
<span id="cb7-107"><a href="open-peer-review.html#cb7-107" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relAgeDE =</span> <span class="fu">abs</span>(AgeComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb7-108"><a href="open-peer-review.html#cb7-108" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">relRateDE =</span> <span class="fu">abs</span>(RateComp)<span class="sc">/</span>(<span class="fu">abs</span>(AgeComp)<span class="sc">+</span><span class="fu">abs</span>(RateComp)))</span>
<span id="cb7-109"><a href="open-peer-review.html#cb7-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-110"><a href="open-peer-review.html#cb7-110" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename</span></span>
<span id="cb7-111"><a href="open-peer-review.html#cb7-111" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">DiffDE=</span>Diff,<span class="at">AgeCompDE=</span>AgeComp,<span class="at">RateCompDE=</span>RateComp)</span>
<span id="cb7-112"><a href="open-peer-review.html#cb7-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-113"><a href="open-peer-review.html#cb7-113" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort data</span></span>
<span id="cb7-114"><a href="open-peer-review.html#cb7-114" aria-hidden="true" tabindex="-1"></a>  DecDE <span class="ot">&lt;-</span> DecDE <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(CFR2) <span class="co"># Appendix</span></span>
<span id="cb7-115"><a href="open-peer-review.html#cb7-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-116"><a href="open-peer-review.html#cb7-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-117"><a href="open-peer-review.html#cb7-117" aria-hidden="true" tabindex="-1"></a><span class="do">### Save extra table ##########################################################</span></span>
<span id="cb7-118"><a href="open-peer-review.html#cb7-118" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-119"><a href="open-peer-review.html#cb7-119" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Appendix table 1</span></span>
<span id="cb7-120"><a href="open-peer-review.html#cb7-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_xlsx</span>(<span class="at">x=</span>DecDE,</span>
<span id="cb7-121"><a href="open-peer-review.html#cb7-121" aria-hidden="true" tabindex="-1"></a>            <span class="at">path=</span><span class="st">&quot;Output/AppendixTab6.xlsx&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="open-peer-review.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Monitoring trends and differences in COVID-19 case fatality  ##############</span></span>
<span id="cb8-2"><a href="open-peer-review.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="do">### rates using decomposition methods: A demographic perspective ##############</span></span>
<span id="cb8-3"><a href="open-peer-review.html#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="open-peer-review.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Last updated: 2020-07-22 11:18:52 CEST</span></span>
<span id="cb8-5"><a href="open-peer-review.html#cb8-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-6"><a href="open-peer-review.html#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Contact:</span></span>
<span id="cb8-7"><a href="open-peer-review.html#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">### riffe@demogr.mpg.de</span></span>
<span id="cb8-8"><a href="open-peer-review.html#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">### acosta@demogr.mpg.de</span></span>
<span id="cb8-9"><a href="open-peer-review.html#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">### dudel@demogr.mpg.de</span></span>
<span id="cb8-10"><a href="open-peer-review.html#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="open-peer-review.html#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="open-peer-review.html#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="do">### Packages ##################################################################</span></span>
<span id="cb8-13"><a href="open-peer-review.html#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="open-peer-review.html#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb8-15"><a href="open-peer-review.html#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggrepel)</span>
<span id="cb8-16"><a href="open-peer-review.html#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(scales)</span>
<span id="cb8-17"><a href="open-peer-review.html#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="open-peer-review.html#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="open-peer-review.html#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="do">### Load data #################################################################</span></span>
<span id="cb8-20"><a href="open-peer-review.html#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="open-peer-review.html#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load data</span></span>
<span id="cb8-22"><a href="open-peer-review.html#cb8-22" aria-hidden="true" tabindex="-1"></a>  db_gh <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;Data/inputdata.csv&quot;</span>)</span>
<span id="cb8-23"><a href="open-peer-review.html#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="open-peer-review.html#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="open-peer-review.html#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="do">### Aggregate data ############################################################</span></span>
<span id="cb8-26"><a href="open-peer-review.html#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="open-peer-review.html#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter date</span></span>
<span id="cb8-28"><a href="open-peer-review.html#cb8-28" aria-hidden="true" tabindex="-1"></a>  db_gh<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(db_gh<span class="sc">$</span>Date,<span class="st">&quot;%d.%m.%y&quot;</span>)</span>
<span id="cb8-29"><a href="open-peer-review.html#cb8-29" aria-hidden="true" tabindex="-1"></a>  db_gh2 <span class="ot">&lt;-</span> db_gh <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Date<span class="sc">&lt;=</span><span class="fu">as.Date</span>(<span class="st">&quot;30.06.2020&quot;</span>,<span class="st">&quot;%d.%m.%y&quot;</span>))</span>
<span id="cb8-30"><a href="open-peer-review.html#cb8-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-31"><a href="open-peer-review.html#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set New York as &quot;country&quot; (easier handling)</span></span>
<span id="cb8-32"><a href="open-peer-review.html#cb8-32" aria-hidden="true" tabindex="-1"></a>  db_gh2<span class="sc">$</span>Country[db_gh2<span class="sc">$</span>Country<span class="sc">==</span><span class="st">&quot;USA&quot;</span> <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Region <span class="sc">==</span> <span class="st">&quot;NYC&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;NYC&quot;</span></span>
<span id="cb8-33"><a href="open-peer-review.html#cb8-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-34"><a href="open-peer-review.html#cb8-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sum data over age groups</span></span>
<span id="cb8-35"><a href="open-peer-review.html#cb8-35" aria-hidden="true" tabindex="-1"></a>  db_gh2 <span class="ot">&lt;-</span> db_gh2 <span class="sc">%&gt;%</span> </span>
<span id="cb8-36"><a href="open-peer-review.html#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>Country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;China&quot;</span>,<span class="st">&quot;USA&quot;</span>,<span class="st">&quot;South Korea&quot;</span>) <span class="sc">&amp;</span> Sex <span class="sc">==</span> <span class="st">&quot;b&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-37"><a href="open-peer-review.html#cb8-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Country, Code,Date) <span class="sc">%&gt;%</span> </span>
<span id="cb8-38"><a href="open-peer-review.html#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Cases =</span> <span class="fu">sum</span>(Cases),</span>
<span id="cb8-39"><a href="open-peer-review.html#cb8-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">Deaths =</span> <span class="fu">sum</span>(Deaths))</span>
<span id="cb8-40"><a href="open-peer-review.html#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="open-peer-review.html#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exclude bolletino </span></span>
<span id="cb8-42"><a href="open-peer-review.html#cb8-42" aria-hidden="true" tabindex="-1"></a>  db_gh2 <span class="ot">&lt;-</span> db_gh2 <span class="sc">%&gt;%</span></span>
<span id="cb8-43"><a href="open-peer-review.html#cb8-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">str_sub</span>(Code, <span class="dv">1</span>, <span class="dv">5</span>) <span class="sc">!=</span> <span class="st">&quot;ITbol&quot;</span>)</span>
<span id="cb8-44"><a href="open-peer-review.html#cb8-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-45"><a href="open-peer-review.html#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort by date</span></span>
<span id="cb8-46"><a href="open-peer-review.html#cb8-46" aria-hidden="true" tabindex="-1"></a>  db_gh2 <span class="ot">&lt;-</span> db_gh2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Country) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Date)</span>
<span id="cb8-47"><a href="open-peer-review.html#cb8-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-48"><a href="open-peer-review.html#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Smooth reporting issues cases</span></span>
<span id="cb8-49"><a href="open-peer-review.html#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(country <span class="cf">in</span> <span class="fu">unique</span>(db_gh2<span class="sc">$</span>Country)) {</span>
<span id="cb8-50"><a href="open-peer-review.html#cb8-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-51"><a href="open-peer-review.html#cb8-51" aria-hidden="true" tabindex="-1"></a>    days <span class="ot">&lt;-</span> db_gh2<span class="sc">$</span>Date[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country]</span>
<span id="cb8-52"><a href="open-peer-review.html#cb8-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-53"><a href="open-peer-review.html#cb8-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(day <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(days)) {</span>
<span id="cb8-54"><a href="open-peer-review.html#cb8-54" aria-hidden="true" tabindex="-1"></a>      current <span class="ot">&lt;-</span> db_gh2<span class="sc">$</span>Cases[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Date<span class="sc">==</span>days[day]]</span>
<span id="cb8-55"><a href="open-peer-review.html#cb8-55" aria-hidden="true" tabindex="-1"></a>      previous <span class="ot">&lt;-</span> db_gh2<span class="sc">$</span>Cases[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Date<span class="sc">==</span>days[day<span class="dv">-1</span>]]</span>
<span id="cb8-56"><a href="open-peer-review.html#cb8-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-57"><a href="open-peer-review.html#cb8-57" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(current<span class="sc">&lt;</span>previous) db_gh2<span class="sc">$</span>Cases[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Date<span class="sc">==</span>days[day]] <span class="ot">&lt;-</span> previous</span>
<span id="cb8-58"><a href="open-peer-review.html#cb8-58" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-59"><a href="open-peer-review.html#cb8-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-60"><a href="open-peer-review.html#cb8-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-61"><a href="open-peer-review.html#cb8-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-62"><a href="open-peer-review.html#cb8-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-63"><a href="open-peer-review.html#cb8-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Smooth reporting issues deaths</span></span>
<span id="cb8-64"><a href="open-peer-review.html#cb8-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(country <span class="cf">in</span> <span class="fu">unique</span>(db_gh2<span class="sc">$</span>Country)) {</span>
<span id="cb8-65"><a href="open-peer-review.html#cb8-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-66"><a href="open-peer-review.html#cb8-66" aria-hidden="true" tabindex="-1"></a>    days <span class="ot">&lt;-</span> db_gh2<span class="sc">$</span>Date[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country]</span>
<span id="cb8-67"><a href="open-peer-review.html#cb8-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-68"><a href="open-peer-review.html#cb8-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(day <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(days)) {</span>
<span id="cb8-69"><a href="open-peer-review.html#cb8-69" aria-hidden="true" tabindex="-1"></a>      current <span class="ot">&lt;-</span> db_gh2<span class="sc">$</span>Deaths[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Date<span class="sc">==</span>days[day]]</span>
<span id="cb8-70"><a href="open-peer-review.html#cb8-70" aria-hidden="true" tabindex="-1"></a>      previous <span class="ot">&lt;-</span> db_gh2<span class="sc">$</span>Deaths[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Date<span class="sc">==</span>days[day<span class="dv">-1</span>]]</span>
<span id="cb8-71"><a href="open-peer-review.html#cb8-71" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-72"><a href="open-peer-review.html#cb8-72" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(current<span class="sc">&lt;</span>previous) db_gh2<span class="sc">$</span>Deaths[db_gh2<span class="sc">$</span>Country<span class="sc">==</span>country <span class="sc">&amp;</span> db_gh2<span class="sc">$</span>Date<span class="sc">==</span>days[day]] <span class="ot">&lt;-</span> previous</span>
<span id="cb8-73"><a href="open-peer-review.html#cb8-73" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-74"><a href="open-peer-review.html#cb8-74" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-75"><a href="open-peer-review.html#cb8-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-76"><a href="open-peer-review.html#cb8-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-77"><a href="open-peer-review.html#cb8-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-78"><a href="open-peer-review.html#cb8-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-79"><a href="open-peer-review.html#cb8-79" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot settings #############################################################</span></span>
<span id="cb8-80"><a href="open-peer-review.html#cb8-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-81"><a href="open-peer-review.html#cb8-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set colors</span></span>
<span id="cb8-82"><a href="open-peer-review.html#cb8-82" aria-hidden="true" tabindex="-1"></a>  col_country <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Germany&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb8-83"><a href="open-peer-review.html#cb8-83" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Italy&quot;</span> <span class="ot">=</span> <span class="st">&quot;#2ca25f&quot;</span>,</span>
<span id="cb8-84"><a href="open-peer-review.html#cb8-84" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;NYC&quot;</span><span class="ot">=</span><span class="st">&quot;#f0027f&quot;</span>,</span>
<span id="cb8-85"><a href="open-peer-review.html#cb8-85" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;Spain&quot;</span><span class="ot">=</span><span class="st">&quot;#beaed4&quot;</span>,</span>
<span id="cb8-86"><a href="open-peer-review.html#cb8-86" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;South Korea&quot;</span><span class="ot">=</span><span class="st">&quot;#fdc086&quot;</span>)<span class="co">#,</span></span>
<span id="cb8-87"><a href="open-peer-review.html#cb8-87" aria-hidden="true" tabindex="-1"></a>                   <span class="co">#&quot;USA&quot;=&quot;#386cb0&quot;)</span></span>
<span id="cb8-88"><a href="open-peer-review.html#cb8-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-89"><a href="open-peer-review.html#cb8-89" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,</span>
<span id="cb8-90"><a href="open-peer-review.html#cb8-90" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;#2ca25f&quot;</span>,</span>
<span id="cb8-91"><a href="open-peer-review.html#cb8-91" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;#f0027f&quot;</span>,</span>
<span id="cb8-92"><a href="open-peer-review.html#cb8-92" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;#beaed4&quot;</span>,</span>
<span id="cb8-93"><a href="open-peer-review.html#cb8-93" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;#fdc086&quot;</span>)<span class="co">#,</span></span>
<span id="cb8-94"><a href="open-peer-review.html#cb8-94" aria-hidden="true" tabindex="-1"></a>            <span class="co">#&quot;#386cb0&quot;)</span></span>
<span id="cb8-95"><a href="open-peer-review.html#cb8-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-96"><a href="open-peer-review.html#cb8-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-97"><a href="open-peer-review.html#cb8-97" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Axis</span></span>
<span id="cb8-98"><a href="open-peer-review.html#cb8-98" aria-hidden="true" tabindex="-1"></a>  labs <span class="ot">&lt;-</span> db_gh2 <span class="sc">%&gt;%</span></span>
<span id="cb8-99"><a href="open-peer-review.html#cb8-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Country) <span class="sc">%&gt;%</span> </span>
<span id="cb8-100"><a href="open-peer-review.html#cb8-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Cases <span class="sc">==</span> <span class="fu">max</span>(Cases)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-101"><a href="open-peer-review.html#cb8-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Cases =</span> Cases <span class="sc">+</span> <span class="dv">3000</span>)</span>
<span id="cb8-102"><a href="open-peer-review.html#cb8-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-103"><a href="open-peer-review.html#cb8-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Including all reports</span></span>
<span id="cb8-104"><a href="open-peer-review.html#cb8-104" aria-hidden="true" tabindex="-1"></a>  tx <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb8-105"><a href="open-peer-review.html#cb8-105" aria-hidden="true" tabindex="-1"></a>  lim_x <span class="ot">&lt;-</span> <span class="dv">240000</span></span>
<span id="cb8-106"><a href="open-peer-review.html#cb8-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-107"><a href="open-peer-review.html#cb8-107" aria-hidden="true" tabindex="-1"></a><span class="do">### Plot ######################################################################</span></span>
<span id="cb8-108"><a href="open-peer-review.html#cb8-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-109"><a href="open-peer-review.html#cb8-109" aria-hidden="true" tabindex="-1"></a>  db_gh2 <span class="sc">%&gt;%</span> </span>
<span id="cb8-110"><a href="open-peer-review.html#cb8-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(Cases, Deaths, <span class="at">col =</span> Country))<span class="sc">+</span></span>
<span id="cb8-111"><a href="open-peer-review.html#cb8-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> .<span class="dv">9</span>)<span class="sc">+</span></span>
<span id="cb8-112"><a href="open-peer-review.html#cb8-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">300000</span>, <span class="dv">50000</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, lim_x <span class="sc">+</span> <span class="dv">30000</span>), <span class="at">labels =</span> comma)<span class="sc">+</span></span>
<span id="cb8-113"><a href="open-peer-review.html#cb8-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">40000</span>, <span class="dv">5000</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">40000</span>), <span class="at">labels =</span> comma)<span class="sc">+</span></span>
<span id="cb8-114"><a href="open-peer-review.html#cb8-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> lim_x, <span class="at">yend =</span> lim_x <span class="sc">*</span> .<span class="dv">02</span>, <span class="at">colour =</span> <span class="st">&quot;grey40&quot;</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb8-115"><a href="open-peer-review.html#cb8-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> lim_x, <span class="at">yend =</span> lim_x <span class="sc">*</span> .<span class="dv">05</span>, <span class="at">colour =</span> <span class="st">&quot;grey40&quot;</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb8-116"><a href="open-peer-review.html#cb8-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> lim_x, <span class="at">yend =</span> lim_x <span class="sc">*</span> .<span class="dv">10</span>, <span class="at">colour =</span> <span class="st">&quot;grey40&quot;</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb8-117"><a href="open-peer-review.html#cb8-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;segment&quot;</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">xend =</span> lim_x, <span class="at">yend =</span> lim_x <span class="sc">*</span> .<span class="dv">15</span>, <span class="at">colour =</span> <span class="st">&quot;grey40&quot;</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb8-118"><a href="open-peer-review.html#cb8-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">label =</span> <span class="st">&quot;2% CFR&quot;</span>, <span class="at">x =</span> lim_x <span class="sc">+</span> <span class="dv">1000</span>, <span class="at">y =</span> lim_x <span class="sc">*</span> .<span class="dv">02</span>,</span>
<span id="cb8-119"><a href="open-peer-review.html#cb8-119" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> tx <span class="sc">*</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">lineheight =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb8-120"><a href="open-peer-review.html#cb8-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">label =</span> <span class="st">&quot;5% CFR&quot;</span>, <span class="at">x =</span> lim_x <span class="sc">+</span> <span class="dv">1000</span>, <span class="at">y =</span> lim_x <span class="sc">*</span> .<span class="dv">05</span>,</span>
<span id="cb8-121"><a href="open-peer-review.html#cb8-121" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> tx <span class="sc">*</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">lineheight =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb8-122"><a href="open-peer-review.html#cb8-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">label =</span> <span class="st">&quot;10% CFR&quot;</span>, <span class="at">x =</span> lim_x <span class="sc">+</span> <span class="dv">1000</span>, <span class="at">y =</span> lim_x <span class="sc">*</span> .<span class="dv">10</span>,</span>
<span id="cb8-123"><a href="open-peer-review.html#cb8-123" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> tx <span class="sc">*</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">lineheight =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb8-124"><a href="open-peer-review.html#cb8-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">label =</span> <span class="st">&quot;15% CFR&quot;</span>, <span class="at">x =</span> lim_x <span class="sc">+</span> <span class="dv">1000</span>, <span class="at">y =</span> lim_x <span class="sc">*</span> .<span class="dv">15</span>,</span>
<span id="cb8-125"><a href="open-peer-review.html#cb8-125" aria-hidden="true" tabindex="-1"></a>             <span class="at">color=</span><span class="st">&quot;grey30&quot;</span>, <span class="at">size =</span> tx <span class="sc">*</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">lineheight =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb8-126"><a href="open-peer-review.html#cb8-126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> cols)<span class="sc">+</span></span>
<span id="cb8-127"><a href="open-peer-review.html#cb8-127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data =</span> labs, <span class="fu">aes</span>(Cases, Deaths, <span class="at">label =</span> Country),</span>
<span id="cb8-128"><a href="open-peer-review.html#cb8-128" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> tx <span class="sc">*</span> .<span class="dv">35</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-129"><a href="open-peer-review.html#cb8-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb8-130"><a href="open-peer-review.html#cb8-130" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Cases&quot;</span>, </span>
<span id="cb8-131"><a href="open-peer-review.html#cb8-131" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;Deaths&quot;</span>)<span class="sc">+</span></span>
<span id="cb8-132"><a href="open-peer-review.html#cb8-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb8-133"><a href="open-peer-review.html#cb8-133" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb8-134"><a href="open-peer-review.html#cb8-134" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb8-135"><a href="open-peer-review.html#cb8-135" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="st">&quot;mm&quot;</span>),</span>
<span id="cb8-136"><a href="open-peer-review.html#cb8-136" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> tx),</span>
<span id="cb8-137"><a href="open-peer-review.html#cb8-137" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> tx),</span>
<span id="cb8-138"><a href="open-peer-review.html#cb8-138" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> tx <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb8-139"><a href="open-peer-review.html#cb8-139" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> tx <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb8-140"><a href="open-peer-review.html#cb8-140" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-141"><a href="open-peer-review.html#cb8-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-142"><a href="open-peer-review.html#cb8-142" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save</span></span>
<span id="cb8-143"><a href="open-peer-review.html#cb8-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="st">&quot;Output/Fig_1.jpg&quot;</span>, <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="dv">3</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="c.-elegans-plate-experiment.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="applying-the-guerrilla-analytics-framework-to-your-own-project..html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
